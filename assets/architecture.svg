<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 520" width="820">
  <defs>
    <linearGradient id="aBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0a0a1a"/>
      <stop offset="100%" style="stop-color:#0f0c29"/>
    </linearGradient>
    <linearGradient id="aAccent" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#7C3AED"/>
      <stop offset="50%" style="stop-color:#2563EB"/>
      <stop offset="100%" style="stop-color:#06B6D4"/>
    </linearGradient>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#4a5568"/>
    </marker>
    <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#2563EB"/>
    </marker>
    <marker id="arrowCyan" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#06B6D4"/>
    </marker>
    <marker id="arrowViolet" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#7C3AED"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="820" height="520" fill="url(#aBg)" rx="12"/>

  <!-- Title -->
  <text x="410" y="36" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif"
        font-size="15" font-weight="700" fill="white" letter-spacing="2">SYSTEM ARCHITECTURE</text>
  <rect x="110" y="44" width="600" height="2" fill="url(#aAccent)" rx="1" opacity="0.5"/>

  <!-- ─── LAYER LABELS ─── -->
  <!-- UI Layer label -->
  <rect x="14" y="65" width="12" height="120" rx="2" fill="#7C3AED" fill-opacity="0.6"/>
  <text x="20" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="9"
        fill="#a78bfa" font-weight="700" transform="rotate(-90,20,175)" letter-spacing="1">UI LAYER</text>

  <!-- Processing Layer label -->
  <rect x="14" y="215" width="12" height="170" rx="2" fill="#2563EB" fill-opacity="0.6"/>
  <text x="20" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="9"
        fill="#60a5fa" font-weight="700" transform="rotate(-90,20,350)" letter-spacing="1">PROCESSING LAYER</text>

  <!-- Output Layer label -->
  <rect x="14" y="415" width="12" height="80" rx="2" fill="#06B6D4" fill-opacity="0.6"/>
  <text x="20" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="9"
        fill="#67e8f9" font-weight="700" transform="rotate(-90,20,470)" letter-spacing="1">OUTPUT</text>

  <!-- ─── UI LAYER ─── -->
  <!-- LieDetectorApp (main window) -->
  <rect x="38" y="65" width="744" height="130" rx="8" fill="#7C3AED" fill-opacity="0.08" stroke="#7C3AED" stroke-width="1.2" stroke-dasharray="6,3"/>
  <text x="56" y="83" font-family="'Segoe UI', Arial, sans-serif" font-size="10" fill="#a78bfa" font-weight="700">LieDetectorApp  (tkinter.Tk root window)</text>

  <!-- Video Feed box -->
  <rect x="56" y="92" width="160" height="90" rx="7" fill="#7C3AED" fill-opacity="0.18" stroke="#7C3AED" stroke-width="1"/>
  <text x="136" y="112" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Video Feed</text>
  <text x="136" y="128" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">ttk.Label (ImageTk)</text>
  <text x="136" y="142" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">640 × 480 display</text>
  <text x="136" y="158" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">50 ms refresh</text>

  <!-- Controls box -->
  <rect x="236" y="92" width="160" height="90" rx="7" fill="#7C3AED" fill-opacity="0.18" stroke="#7C3AED" stroke-width="1"/>
  <text x="316" y="112" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Controls Panel</text>
  <text x="316" y="128" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Buttons · Sliders</text>
  <text x="316" y="142" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Duration · Sensitivity</text>
  <text x="316" y="158" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Question entry</text>

  <!-- Metrics Panel box -->
  <rect x="416" y="92" width="160" height="90" rx="7" fill="#7C3AED" fill-opacity="0.18" stroke="#7C3AED" stroke-width="1"/>
  <text x="496" y="112" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Metrics Panel</text>
  <text x="496" y="128" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">EAR · Blink rate</text>
  <text x="496" y="142" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Asymmetry · Emotion</text>
  <text x="496" y="158" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Deception %</text>

  <!-- Graphs box -->
  <rect x="596" y="92" width="168" height="90" rx="7" fill="#7C3AED" fill-opacity="0.18" stroke="#7C3AED" stroke-width="1"/>
  <text x="680" y="112" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Live Graphs</text>
  <text x="680" y="128" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">matplotlib embedded</text>
  <text x="680" y="142" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Deception timeline</text>
  <text x="680" y="158" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Normalized metrics</text>

  <!-- ─── THREAD BOUNDARY ─── -->
  <rect x="38" y="215" width="744" height="50" rx="6" fill="#2563EB" fill-opacity="0.06" stroke="#2563EB" stroke-width="0.8" stroke-dasharray="4,4"/>
  <text x="410" y="235" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#60a5fa" letter-spacing="1">── THREAD BOUNDARY: process_video() runs as daemon Thread ──</text>
  <text x="410" y="252" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#4a5568">threading.Lock() guards shared display state (_photo, _metrics, _display_img)</text>

  <!-- ─── PROCESSING LAYER ─── -->
  <!-- OpenCV Capture -->
  <rect x="56" y="285" width="145" height="90" rx="7" fill="#2563EB" fill-opacity="0.15" stroke="#2563EB" stroke-width="1"/>
  <text x="128" y="306" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">OpenCV Capture</text>
  <text x="128" y="322" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">cv2.VideoCapture</text>
  <text x="128" y="336" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">0.5× downscale</text>
  <text x="128" y="350" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">every-other-frame skip</text>
  <text x="128" y="364" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#60a5fa">BGR → RGB</text>

  <!-- MediaPipe FaceMesh -->
  <rect x="228" y="285" width="145" height="90" rx="7" fill="#2563EB" fill-opacity="0.15" stroke="#2563EB" stroke-width="1"/>
  <text x="300" y="306" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">MediaPipe</text>
  <text x="300" y="320" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="10" font-weight="600" fill="white">FaceMesh</text>
  <text x="300" y="336" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">468 3D landmarks</text>
  <text x="300" y="350" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">1 face, conf ≥ 0.6</text>
  <text x="300" y="364" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#60a5fa">FACEMESH_CONTOURS</text>

  <!-- Feature Extraction -->
  <rect x="400" y="285" width="145" height="90" rx="7" fill="#2563EB" fill-opacity="0.15" stroke="#2563EB" stroke-width="1"/>
  <text x="472" y="306" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Feature Extractor</text>
  <text x="472" y="322" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">EAR · Asymmetry</text>
  <text x="472" y="336" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Blink rate (60 s window)</text>
  <text x="472" y="350" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">Eye movement deque</text>
  <text x="472" y="364" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#60a5fa">Microexpression velocity</text>

  <!-- FER + RF Model -->
  <rect x="572" y="285" width="195" height="90" rx="7" fill="#2563EB" fill-opacity="0.15" stroke="#2563EB" stroke-width="1"/>
  <text x="669" y="306" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">FER + RF Classifier</text>
  <text x="669" y="322" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">FER (MTCNN) → 7 emotions</text>
  <text x="669" y="336" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">RandomForest (100 trees)</text>
  <text x="669" y="350" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">predict_proba() × sensitivity</text>
  <text x="669" y="364" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#60a5fa">Baseline deviation scoring</text>

  <!-- Baseline store -->
  <rect x="228" y="395" width="195" height="75" rx="7" fill="#06B6D4" fill-opacity="0.12" stroke="#06B6D4" stroke-width="1"/>
  <text x="325" y="416" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">Baseline Store</text>
  <text x="325" y="432" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">10 s neutral calibration</text>
  <text x="325" y="446" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">EAR · blink · asymmetry means</text>
  <text x="325" y="460" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#67e8f9">2σ outlier filtering</text>

  <!-- ─── OUTPUT LAYER ─── -->
  <!-- frame_data deque -->
  <rect x="56" y="430" width="145" height="60" rx="7" fill="#06B6D4" fill-opacity="0.12" stroke="#06B6D4" stroke-width="1"/>
  <text x="128" y="450" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">frame_data deque</text>
  <text x="128" y="466" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">maxlen 10 000 frames</text>
  <text x="128" y="480" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#67e8f9">pandas DataFrame export</text>

  <!-- CSV / TXT Export -->
  <rect x="572" y="430" width="195" height="60" rx="7" fill="#06B6D4" fill-opacity="0.12" stroke="#06B6D4" stroke-width="1"/>
  <text x="669" y="450" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="11" font-weight="700" fill="white">CSV / TXT Export</text>
  <text x="669" y="466" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#a8b2d8">df.to_csv() + summary report</text>
  <text x="669" y="480" text-anchor="middle" font-family="'Segoe UI', Arial, sans-serif" font-size="9" fill="#67e8f9">filedialog save path</text>

  <!-- ─── ARROWS ─── -->
  <!-- Webcam → OpenCV -->
  <line x1="128" y1="205" x2="128" y2="283" stroke="#2563EB" stroke-width="1.4" marker-end="url(#arrowBlue)" stroke-dasharray="4,3"/>
  <text x="132" y="248" font-family="Arial, sans-serif" font-size="8" fill="#4a5568">webcam</text>

  <!-- OpenCV → MediaPipe -->
  <line x1="202" y1="330" x2="226" y2="330" stroke="#2563EB" stroke-width="1.4" marker-end="url(#arrowBlue)"/>

  <!-- MediaPipe → Feature Extractor -->
  <line x1="374" y1="330" x2="398" y2="330" stroke="#2563EB" stroke-width="1.4" marker-end="url(#arrowBlue)"/>

  <!-- Feature Extractor → FER + RF -->
  <line x1="546" y1="330" x2="570" y2="330" stroke="#2563EB" stroke-width="1.4" marker-end="url(#arrowBlue)"/>

  <!-- Feature Extractor → Baseline (down-left) -->
  <line x1="472" y1="376" x2="390" y2="393" stroke="#06B6D4" stroke-width="1.2" marker-end="url(#arrowCyan)" stroke-dasharray="3,3"/>

  <!-- Baseline → RF (right) -->
  <line x1="424" y1="432" x2="572" y2="360" stroke="#06B6D4" stroke-width="1.2" marker-end="url(#arrowCyan)" stroke-dasharray="3,3"/>

  <!-- RF → frame_data -->
  <line x1="669" y1="376" x2="200" y2="450" stroke="#4a5568" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- frame_data → CSV -->
  <line x1="202" y1="460" x2="570" y2="460" stroke="#06B6D4" stroke-width="1.2" marker-end="url(#arrowCyan)"/>

  <!-- RF → UI Metrics (up) -->
  <line x1="669" y1="284" x2="530" y2="183" stroke="#7C3AED" stroke-width="1.2" marker-end="url(#arrowViolet)" stroke-dasharray="4,3"/>
  <text x="618" y="242" font-family="Arial, sans-serif" font-size="8" fill="#a78bfa">metrics dict</text>

  <!-- OpenCV → Video Feed (up) -->
  <line x1="128" y1="284" x2="136" y2="183" stroke="#7C3AED" stroke-width="1.2" marker-end="url(#arrowViolet)" stroke-dasharray="4,3"/>
  <text x="90" y="242" font-family="Arial, sans-serif" font-size="8" fill="#a78bfa">BGR frame</text>
</svg>
